<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psychometric Score Calculator</title>
    <style>
        body { font-family: sans-serif; max-width: 700px; margin: 20px auto; padding: 20px; line-height: 1.6; background-color: #f0f2f5; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #1a73e8; margin-top: 0; }
        .domain-section { margin-bottom: 25px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 8px; transition: border-color 0.3s; }
        .domain-title { font-weight: bold; font-size: 1.1em; margin-bottom: 10px; color: #3c4043; }
        .inputs { display: flex; gap: 10px; }
        .input-group { flex: 1; }
        label { display: block; font-size: 0.8em; margin-bottom: 3px; }
        input { width: 100%; padding: 8px; border: 1px solid #bdc1c6; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background-color: #1a73e8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-top: 10px; font-weight: bold; }
        button:hover { background-color: #1557b0; }
        .results { margin-top: 25px; display: none; }
        .score-box { background: #e8f0fe; padding: 15px; border-radius: 6px; margin-bottom: 12px; border-left: 6px solid #1a73e8; }
        .score-val { font-size: 22px; font-weight: bold; color: #174ea6; }
        .percentile-text { font-size: 0.9em; color: #5f6368; display: block; margin-top: 5px; }
        .logic-note { font-size: 0.85em; color: #5f6368; font-style: italic; }
        .error-border { border: 2px solid #d93025 !important; background-color: #fce8e6; }
        .domain-error { border: 2px solid #d93025; }
    </style>
</head>
<body>

<div class="card">
    <h2>Score Estimator</h2>
    <p>Input up to 3 scores per domain. The app will randomly select 2 to simulate a pilot section and calculate your estimate using <a href="calculation_method.pdf" target="_blank" rel="noopener noreferrer">this method and data</a>.</p>
    
    <div class="domain-section" id="q-section">
        <div class="domain-title">Quantitative Reasoning (0 - 20 per section)</div>
        <div class="inputs">
            <div class="input-group"><label>Section 1 </label><input type="number" class="q-in" min="0" max="20"></div>
            <div class="input-group"><label>Section 2</label><input type="number" class="q-in" min="0" max="20"></div>
            <div class="input-group"><label>Section 3 (Opt)</label><input type="number" class="q-in" min="0" max="20"></div>
        </div>
    </div>

    <div class="domain-section" id="v-section">
        <div class="domain-title">Verbal Reasoning (0 - 20 per section)</div>
        <div class="inputs">
            <div class="input-group"><label>Section 1</label><input type="number" class="v-in" min="0" max="20"></div>
            <div class="input-group"><label>Section 2</label><input type="number" class="v-in" min="0" max="20"></div>
            <div class="input-group"><label>Section 3 (Opt)</label><input type="number" class="v-in" min="0" max="20"></div>
        </div>
    </div>

    <div class="domain-section" id="e-section">
        <div class="domain-title">English (0 - 22 per section)</div>
        <div class="inputs">
            <div class="input-group"><label>Section 1</label><input type="number" class="e-in" min="0" max="22"></div>
            <div class="input-group"><label>Section 2</label><input type="number" class="e-in" min="0" max="22"></div>
            <div class="input-group"><label>Section 3 (Opt)</label><input type="number" class="e-in" min="0" max="22"></div>
        </div>
    </div>

    <button onclick="calculateRandomized()">Calculate Estimated Score Range</button>

    <div id="results" class="results" >
        <h3>Psychometry Test Results</h3>
        <p class="logic-note" id="selection-log"></p>
        <div class="score-box">
            Multi-Domain General Score: <br><span id="res_multi" class="score-val"></span>
            <span id="perc_multi" class="percentile-text"></span>
        </div>
        <div class="score-box">
            Math Oriented: <br><span id="res_sci" class="score-val"></span>
            <span id="perc_sci" class="percentile-text"></span>
        </div>
        <div class="score-box">
            Verbal Oriented: <br><span id="res_hum" class="score-val"></span>
            <span id="perc_hum" class="percentile-text"></span>
        </div>
    </div>
</div>

<script>
    // Data Tables [cite: 15, 16, 23-82]
    const vTable = {0:50,1:52,2:54,3:56,4:58,5:60,6:63,7:65,8:68,9:70,10:73,11:76,12:78,13:81,14:83,15:86,16:89,17:91,18:94,19:96,20:99,21:102,22:105,23:107,24:110,25:113,26:116,27:119,28:121,29:124,30:127,31:131,32:133,33:136,34:137,35:140,36:142,37:144,38:146,39:148,40:150};
    const qTable = {0:50,1:52,2:54,3:56,4:58,5:60,6:62,7:65,8:67,9:70,10:72,11:75,12:78,13:80,14:83,15:86,16:89,17:92,18:94,19:97,20:100,21:103,22:106,23:108,24:111,25:114,26:117,27:120,28:123,29:126,30:129,31:130,32:132,33:135,34:138,35:140,36:142,37:144,38:146,39:148,40:150};
    const eTable = {0:50,1:51,2:52,3:53,4:55,5:57,6:59,7:60,8:62,9:63,10:65,11:67,12:69,13:72,14:74,15:76,16:78,17:81,18:83,19:86,20:88,21:91,22:93,23:96,24:98,25:101,26:103,27:106,28:108,29:111,30:113,31:115,32:118,33:120,34:123,35:125,36:127,37:130,38:132,39:135,40:138,41:141,42:144,43:147,44:150};

    function getRange(w) {
        const r = Math.round(w);
        if (r <= 50) return "200";
        const ranges = [[51,55,"221 - 248"],[56,60,"249 - 276"],[61,65,"277 - 304"],[66,70,"305 - 333"],[71,75,"334 - 361"],[76,80,"362 - 389"],[81,85,"390 - 418"],[86,90,"419 - 446"],[91,95,"447 - 474"],[96,100,"475 - 503"],[101,105,"504 - 531"],[106,110,"532 - 559"],[111,115,"560 - 587"],[116,120,"588 - 616"],[121,125,"617 - 644"],[126,130,"645 - 672"],[131,135,"673 - 701"],[136,140,"702 - 729"],[141,145,"730 - 761"],[146,149,"762 - 795"]];
        for (let range of ranges) if (r >= range[0] && r <= range[1]) return range[2];
        return "800";
    }

    // Percentile Table 
    function getPercentile(rangeStr) {
        if (rangeStr === "200") return "Approximately 0% scored below this score.";
        if (rangeStr === "800") return "Approximately 97% scored below this score.";
        
        const avgScore = parseInt(rangeStr.split(' - ')[0]);
        const percentiles = [
            {max: 349, below: 0}, {max: 374, below: 6}, {max: 399, below: 10}, 
            {max: 424, below: 15}, {max: 449, below: 20}, {max: 474, below: 26}, 
            {max: 499, below: 33}, {max: 524, below: 40}, {max: 549, below: 47}, 
            {max: 574, below: 54}, {max: 599, below: 61}, {max: 624, below: 68}, 
            {max: 649, below: 76}, {max: 674, below: 83}, {max: 699, below: 89}, 
            {max: 724, below: 94}, {max: 800, below: 97}
        ];

        for (let p of percentiles) {
            if (avgScore <= p.max) return `Approximately ${p.below}% of examinees scored below this range.`;
        }
        return "";
    }

    function pickTwoRandom(className) {
        const inputs = Array.from(document.querySelectorAll(className))
                            .map(i => i.value)
                            .filter(v => v !== "");
        if (inputs.length === 2) return Number(inputs[0]) + Number(inputs[1]);
        const shuffled = inputs.sort(() => 0.5 - Math.random());
        return Number(shuffled[0]) + Number(shuffled[1]);
    }

    function calculateRandomized() {
        let hasError = false;
        const allDomains = [
            { selector: '.q-in', section: 'q-section', max: 20, name: 'Quantitative' },
            { selector: '.v-in', section: 'v-section', max: 20, name: 'Verbal' },
            { selector: '.e-in', section: 'e-section', max: 22, name: 'English' }
        ];

        // Reset previous errors
        document.querySelectorAll('input').forEach(i => i.classList.remove('error-border'));
        document.querySelectorAll('.domain-section').forEach(s => s.classList.remove('domain-error'));

        for (const domain of allDomains) {
            const inputs = Array.from(document.querySelectorAll(domain.selector));
            const activeValues = inputs.map(i => i.value.trim()).filter(v => v !== "");

            // 1. Check if domain has at least 2 values
            if (activeValues.length < 2) {
                document.getElementById(domain.section).classList.add('domain-error');
                hasError = true;
            }

            // 2. Check individual ranges
            for (const input of inputs) {
                const val = Number(input.value);
                if (input.value !== "" && (isNaN(val) || val < 0 || val > domain.max)) {
                    input.classList.add('error-border');
                    hasError = true;
                }
            }
        }

        if (hasError) {
            return;
        }

        // Proceed with calculation [cite: 6, 91, 94, 97]
        const vRaw = pickTwoRandom('.v-in');
        const qRaw = pickTwoRandom('.q-in');
        const eRaw = pickTwoRandom('.e-in');

        const vStd = vTable[vRaw] || 50;
        const qStd = qTable[qRaw] || 50;
        const eStd = eTable[eRaw] || 50;

        const multi = (2*vStd + 2*qStd + eStd) / 5;
        const hum = (3*vStd + qStd + eStd) / 5;
        const sci = (3*qStd + vStd + eStd) / 5;

        const rMulti = getRange(multi);
        const rHum = getRange(hum);
        const rSci = getRange(sci);

        document.getElementById('res_multi').innerText = rMulti;
        document.getElementById('perc_multi').innerText = getPercentile(rMulti);
        
        document.getElementById('res_hum').innerText = rHum;
        document.getElementById('perc_hum').innerText = getPercentile(rHum);
        
        document.getElementById('res_sci').innerText = rSci;
        document.getElementById('perc_sci').innerText = getPercentile(rSci);

        document.getElementById('selection-log').innerText = `Used Raw Totals: Quantitative ${qRaw}, Verbal ${vRaw}, English ${eRaw}`;
        document.getElementById('results').style.display = 'block';
    }
</script>
</body>
</html>